<header class="header">
    <div class="top">
        <div class="logo">
            <a href="./index.html">
                <picture>
                    <source media="(max-width: 1000px)" srcset="./pic/img/LOGO/RWD.png" />
                    <source media="(max-width: 912px)" srcset="./pic/img/LOGO/RWD.png" />
                    <source media="(max-width: 820px)" srcset="./pic/img/LOGO/RWD.png" />
                    <source media="(max-width: 414px)" srcset="./pic/img/LOGO/RWD.png" />
                    <source media="(max-width: 540px)" srcset="./pic/img/LOGO/RWD.png" />
                    <img src="./pic/img/LOGO/WEBLOGO.png" alt="" />
                </picture>
            </a>
        </div>

        <nav class="menu">
            <ul class="a_part">
                <li data-index="1"><a href="./product.html" class="@@product">商品</a></li>
                <li data-index="2"><a href="./news.html" class="@@news">新聞</a></li>
                <li data-index="3"><a href="./AI_test_index.html" class="@@AI_test">智能推薦</a></li>
                <li data-index="4">
                    <a href="./game_library.html" class="@@game_library">遊戲庫</a>
                </li>
            </ul>
            <ul class="b_part">
                <form action="/" method="get">
                    <input type="text" name="search" placeholder="  請輸入關鍵字" />
                </form>

                <ul class="b_2">
                    <li data-index="5">
                        <a href="#">近期預覽</a>
                        <ul class="b_2-1">
                            <li>
                                <a href="./product.html">
                                    <img src="./pic/img/product/demo/0001552371.jpg" alt="" />
                                    <div class="p">
                                        <p class="title">火影忍者 疾風傳 終極風暴 經典傳承</p>
                                        <p class="price">¥3,205</p>
                                        <p class="price2">¥3,000</p>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="./product.html">
                                    <img src="./pic/img/product/demo/729.jpg" alt="" />
                                    <div class="p">
                                        <p class="title">KINGDOM HEARTS III 王國之心3</p>
                                        <p class="price">¥9,680</p>
                                        <p class="price2">¥9,000</p>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="./product.html">
                                    <img src="./pic/img/product/demo/728.jpg" alt="" />
                                    <div class="p">
                                        <p class="title">Rabi-Ribi 拉比哩比</p>
                                        <p class="price">¥2,700</p>
                                        <p class="price2">¥2,000</p>
                                    </div>
                                </a>
                            </li>
                        </ul>
                    </li>

                    <template v-if="!isLogin">
                        <li data-index="6"><a href="./register.html" data-href="./register.html">註冊</a></li>
                        <li data-index="7"><a href="./login.html" data-href="./login.html">登入</a></li>
                    </template>

                    <template v-else>
                        <li data-index="6">
                            <a href="./member_center.html" class="google_photo">
                                <img :src="this.photo" alt="">
                            </a>
                        </li>
                        <li data-index="7"><a href="./login.html" data-href="./login.html" @click="logout">登出</a></li>
                    </template>

                    <li data-index="8">
                        <a href="./checkout.html" data-href="./checkout.html">
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                class="bi bi-cart" viewBox="0 0 16 16">
                                <path
                                    d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM3.102 4l1.313 7h8.17l1.313-7H3.102zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z" />
                            </svg>
                        </a>
                    </li>
                </ul>
            </ul>
            <ul class="c_part">
                <li class="fafa">
                    <!-- <i class="fa fa-bars" aria-hidden="true"></i> -->
                    <div class="toggle">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </li>

                <div class="rwd-item">
                    <ul class="r-item">
                        <form class="search" action="/" method="get">
                            <input type="text" name="search" placeholder="  請輸入關鍵字" />
                        </form>
                        <li><a href="./product.html">商品 </a></li>
                        <li><a href="./news.html">新聞 </a></li>
                        <li><a href="./AI_test_index.html">智能推薦</a></li>
                        <li><a href="./game_library.html">遊戲庫 </a></li>
                        <li><a href="./login.html">登入 </a></li>
                        <li><a href="./member_center.html">會員中心</a></li>
                        <li><a href="./checkout.html">購物車</a></li>
                    </ul>
                </div>
            </ul>
        </nav>
    </div>
</header>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
<script src="./vendors/vue/vue.global.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.6/axios.min.js"
    integrity="sha512-06NZg89vaTNvnFgFTqi/dJKFadQ6FIglD6Yg1HHWAUtVFFoXli9BZL4q4EO1UTKpOfCfW5ws2Z6gw49Swsilsg=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
<script src="../js/constant.js"></script>

<script>
    // ==========RWD漢堡選單收合==========
    $(document).ready(function () {
        $('.toggle').click(function () {
            $(this).toggleClass('active');
            if ($(this).hasClass('active')) {
                $('.rwd-item').slideDown();
            } else {
                $('.rwd-item').slideUp();
            }
        })
    });

    // ------------------------------------
    document.addEventListener("DOMContentLoaded", function () {
        const activeLiIndex = localStorage.getItem("activeLiIndex");
        if (activeLiIndex !== null) {
            const lis = document.querySelectorAll(".a_part li, .b_2 li");
            lis.forEach(function (li) {
                const anchor = li.querySelector("a");
                if (li.dataset.index === activeLiIndex) {
                    anchor.classList.add("active");
                } else {
                    anchor.classList.remove("active");
                }
            });
        }
    });

    document.addEventListener("click", function (event) {
        const clickedLi = event.target.closest("li");
        if (clickedLi) {
            const isAPart = clickedLi.parentElement.classList.contains("a_part");
            const isB2 = clickedLi.parentElement.classList.contains("b_2");

            if (isAPart || isB2) {
                const lis = document.querySelectorAll(".a_part li, .b_2 li");
                lis.forEach(function (li) {
                    const anchor = li.querySelector("a");
                    anchor.classList.remove("active");
                });

                const anchor = clickedLi.querySelector("a");
                anchor.classList.add("active");

                // 保存点击的索引或标识到本地存储
                localStorage.setItem("activeLiIndex", clickedLi.dataset.index);
            }
        } else {
            const lis = document.querySelectorAll(".a_part li, .b_2 li");
            lis.forEach(function (li) {
                const anchor = li.querySelector("a");
                anchor.classList.remove("active");
            });
            localStorage.removeItem("activeLiIndex");
        }
    });

    // ===========登入判斷===============
    Vue.createApp({
        data() {
            return {
                isLogin: false,
                photo: null,
                nickname: null
            }
        },
        methods: {
            logout() {
                axios.defaults.withCredentials = true;
                axios.post(php_url + 'logout.php')
                    .then((response) => alert("您已登出"))
            }
        },
        mounted() {
            axios.defaults.withCredentials = true;
            axios.post(php_url + 'login_status.php')
                .then((response) => {
                    // console.log(response);
                    this.isLogin = response.data.isLogin;
                    this.photo = response.data.photo;
                    this.nickname = response.data.nickname;
                })
        }
    }).mount(".b_2");

</script>